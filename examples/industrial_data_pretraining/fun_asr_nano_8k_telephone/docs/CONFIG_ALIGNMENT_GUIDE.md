# é…ç½®å¯¹é½æŒ‡å— - Fun-ASR-Nano 8kHzç”µè¯é¢‘é“å¾®è°ƒ

## ğŸ“š æ–‡æ¡£å¯¼èˆª

æœ¬ç›®å½•åŒ…å«ä¸‰ä»½é…ç½®å¯¹é½æ–‡æ¡£,ç”¨äºç†è§£é¢„è®­ç»ƒæ¨¡å‹é…ç½®ä¸å¾®è°ƒé…ç½®çš„å·®å¼‚:

### 1. **QUICK_CONFIG_DIFF.md** â­ (æ¨èé¦–å…ˆé˜…è¯»)
å¿«é€Ÿå‚è€ƒæŒ‡å—,å±•ç¤ºæœ€å…³é”®çš„é…ç½®å·®å¼‚ã€‚
- **é€‚åˆ:** æƒ³å¿«é€Ÿäº†è§£æ”¹äº†ä»€ä¹ˆ
- **å†…å®¹:** å…³é”®å‚æ•°å¯¹æ¯”ã€å­¦ä¹ ç‡ã€å†»ç»“ç­–ç•¥
- **é˜…è¯»æ—¶é—´:** 5-10åˆ†é’Ÿ
- **ä½¿ç”¨åœºæ™¯:** ä¿®æ”¹é…ç½®å‰å¿«é€Ÿæ£€æŸ¥æ¸…å•

### 2. **CONFIG_COMPARISON_TABLE.md** ğŸ“Š (è¡¨æ ¼å‚è€ƒ)
è¯¦ç»†çš„è¡¨æ ¼å¯¹æ¯”,æŒ‰æ¨¡å—åˆ†ç±»æ˜¾ç¤ºæ‰€æœ‰å·®å¼‚ã€‚
- **é€‚åˆ:** éœ€è¦æŸ¥çœ‹ç‰¹å®šæ¨¡å—çš„æ”¹åŠ¨
- **å†…å®¹:** å®Œæ•´çš„å‚æ•°å¯¹æ¯”è¡¨ã€åˆ†ç±»ç»Ÿè®¡ã€éªŒè¯æ¸…å•
- **é˜…è¯»æ—¶é—´:** 15-20åˆ†é’Ÿ
- **ä½¿ç”¨åœºæ™¯:** è°ƒè¯•ç‰¹å®šå‚æ•°æ—¶æŸ¥é˜…

### 3. **CONFIGURATION_ALIGNMENT.md** ğŸ“– (æ·±åº¦å‚è€ƒ)
æœ€è¯¦ç»†çš„é…ç½®æ–‡æ¡£,åŒ…å«æ¯ä¸ªå‚æ•°çš„å®Œæ•´è¯´æ˜ã€‚
- **é€‚åˆ:** æ·±åº¦ç†è§£æ¯ä¸ªå‚æ•°çš„ä½œç”¨å’Œæ”¹åŠ¨åŸå› 
- **å†…å®¹:** å®Œæ•´çš„å‚æ•°æ˜ å°„ã€ä»£ç é»˜è®¤å€¼ã€ä¿®æ”¹åŸå› è¯¦è§£
- **é˜…è¯»æ—¶é—´:** 30-40åˆ†é’Ÿ
- **ä½¿ç”¨åœºæ™¯:** å­¦ä¹ æˆ–å®šåˆ¶é…ç½®æ—¶çš„å‚è€ƒæ‰‹å†Œ

---

## ğŸ¯ æŒ‰åœºæ™¯é€‰æ‹©æ–‡æ¡£

### åœºæ™¯1: æˆ‘æƒ³å¿«é€Ÿå¼€å§‹è®­ç»ƒ
```
1. é˜…è¯» QUICK_CONFIG_DIFF.md ç¬¬ 1-3 èŠ‚ (5åˆ†é’Ÿ)
   â†“ äº†è§£Encoderã€å­¦ä¹ ç‡ã€CTCçš„æ”¹åŠ¨
   â†“
2. æ£€æŸ¥ CONFIG_COMPARISON_TABLE.md çš„"é…ç½®éªŒè¯æ¸…å•" (2åˆ†é’Ÿ)
   â†“
3. è¿è¡Œè®­ç»ƒè„šæœ¬
```

### åœºæ™¯2: æˆ‘éœ€è¦ä¿®æ”¹å­¦ä¹ ç‡æˆ–è¶…å‚æ•°
```
1. æŸ¥çœ‹ QUICK_CONFIG_DIFF.md ç¬¬ 3 èŠ‚ (å­¦ä¹ ç‡è¯´æ˜) (2åˆ†é’Ÿ)
   â†“
2. æŸ¥çœ‹ CONFIG_COMPARISON_TABLE.md çš„"ä¼˜åŒ–å™¨ä¸å­¦ä¹ ç‡"è¡¨ (2åˆ†é’Ÿ)
   â†“
3. æ ¹æ®ä½ çš„æ•°æ®è§„æ¨¡è°ƒæ•´å‚æ•°
   â†“
4. ä½¿ç”¨ CONFIGURATION_ALIGNMENT.md éªŒè¯æ˜¯å¦æœ‰å…³è”å‚æ•°éœ€è¦è°ƒæ•´
```

### åœºæ™¯3: æˆ‘æƒ³ç†è§£Stage1å’ŒMain configçš„åŒºåˆ«
```
1. é˜…è¯» QUICK_CONFIG_DIFF.md ç¬¬ 10 èŠ‚ (2åˆ†é’Ÿ)
   â†“ "å‚æ•°æºæŒ‰é˜¶æ®µ"éƒ¨åˆ†æ˜ç¡®è¯´æ˜äº†ä¸¤ä¸ªç‰ˆæœ¬çš„åŒºåˆ«
   â†“
2. å¯¹æ¯” stage1_encoder_adapt.yaml å’Œ config_8k_telephone.yaml
   â†“
3. æŸ¥çœ‹ CONFIG_COMPARISON_TABLE.md çš„CTC Decoderå’ŒFrontendè¡Œ
```

### åœºæ™¯4: æˆ‘éœ€è¦è°ƒè¯•è®­ç»ƒé—®é¢˜
```
1. å¿«é€Ÿæµè§ˆ QUICK_CONFIG_DIFF.md çš„"å…³é”®å‚æ•°"éƒ¨åˆ† (3åˆ†é’Ÿ)
   â†“
2. æŸ¥çœ‹ CONFIG_COMPARISON_TABLE.md çš„"é¢„æœŸè®­ç»ƒæ•ˆæœ"è¡¨
   â†“
3. æ ¹æ®é—®é¢˜æŸ¥çœ‹å¯¹åº”çš„å‚æ•°:
   - Lossä¸ä¸‹é™ â†’ æ£€æŸ¥å­¦ä¹ ç‡ã€weight_decay
   - æ˜¾å­˜ä¸è¶³ â†’ æ£€æŸ¥max_token_lengthã€batch_size
   - è®­ç»ƒå¤ªæ…¢ â†’ æ£€æŸ¥num_workersã€log_interval
   â†“
4. ç”¨ CONFIGURATION_ALIGNMENT.md æŸ¥çœ‹è¯¦ç»†è¯´æ˜
```

### åœºæ™¯5: æˆ‘æƒ³å®šåˆ¶åŒ–é…ç½®
```
1. å®Œæ•´é˜…è¯» QUICK_CONFIG_DIFF.md (15åˆ†é’Ÿ)
   â†“ ç†è§£æ‰€æœ‰å…³é”®æ”¹åŠ¨
   â†“
2. ç³»ç»Ÿé˜…è¯» CONFIG_COMPARISON_TABLE.md (20åˆ†é’Ÿ)
   â†“ äº†è§£å®Œæ•´çš„å‚æ•°æ˜ å°„
   â†“
3. å‚è€ƒ CONFIGURATION_ALIGNMENT.md (20åˆ†é’Ÿ)
   â†“ ç†è§£æ¯ä¸ªå‚æ•°çš„ä½œç”¨
   â†“
4. åˆ›å»ºè‡ªå·±çš„config.yaml
```

---

## ğŸ”‘ å…³é”®æ¦‚å¿µé€ŸæŸ¥è¡¨

### ä»€ä¹ˆè¢«æ”¹äº†? (ğŸ”´ CRITICAL CHANGES)

| å‚æ•° | é¢„è®­ç»ƒ | å¾®è°ƒ | ä¸ºä»€ä¹ˆ? |
|------|------|-----|--------|
| `audio_encoder_conf.freeze` | `true` | `false` | éœ€è¦é€‚åº”8kHzé¢‘è°± |
| `optim_conf.lr` | `5e-6` | `5e-5 ~ 1e-4` | é¢„è®­ç»ƒLRå¤ªå°,å¾®è°ƒéœ€è¦æ›´é«˜LR |
| `train_conf.use_deepspeed` | `true` | `false` | å…³é—­åˆ†å¸ƒå¼,ä½¿ç”¨å•GPU |
| `ctc_decoder_conf.freeze` | `false` | Stage1:`true`, Main:`false` | Stage1ä¸“æ³¨encoder,Mainè®­ç»ƒCTC |
| `frontend_conf.fs` | `16000` | Stage1:`8000`, Main:`16000` | Stage1åŸç”Ÿ8kHz,Mainä¸Šé‡‡æ · |

### ä»€ä¹ˆæ²¡å˜? (ğŸŸ¢ ALIGNED)

| ç»„ä»¶ | çŠ¶æ€ |
|------|------|
| LLM (Qwen3-0.6B) | âœ… å§‹ç»ˆå†»ç»“ |
| Audio Adaptor | âœ… å§‹ç»ˆå†»ç»“ |
| Modelç±»å‹ | âœ… å§‹ç»ˆFunASRNano |
| Batchå¤§å° | âœ… å§‹ç»ˆ6000 tokens |

### ä»€ä¹ˆæ˜¯æ–°å¢çš„? (ğŸŸ  NEW)

| é¡¹ç›® | é¢„è®­ç»ƒä¸­ | å¾®è°ƒä¸­ |
|------|---------|--------|
| SpecAugmentation | âŒ æ—  | âœ… æ–°å¢SpecAugLFR |
| é¢‘ç‡æ©ç  | âŒ æ—  | âœ… æ–°å¢[0,10-15] |
| æ—¶é—´æ©ç  | âŒ æ—  | âœ… æ–°å¢[0,10-50] |
| Weight Decay | âŒ 0.0 | âœ… 0.01 |

### ä»€ä¹ˆä½¿ç”¨é»˜è®¤å€¼? (âšª OMITTED)

è®¸å¤šå‚æ•°æœªåœ¨å¾®è°ƒé…ç½®ä¸­æŒ‡å®š,ä½¿ç”¨ä»£ç é»˜è®¤å€¼:
- Encoderå‚æ•°: `attention_heads`, `linear_units`, `num_blocks` ç­‰
- LLMå‚æ•°: `llm_dtype`, `init_param_path` ç­‰
- CTCå‚æ•°: `ffn_dim`, `encoder_dim` ç­‰

**å…³é”®:** è¿™äº›éƒ½æ¥è‡ªé¢„è®­ç»ƒæ¨¡å‹,åº”è¯¥ä¿æŒä¸å˜ã€‚

---

## âš ï¸ å¸¸è§é”™è¯¯å’Œçº æ­£

### âŒ é”™è¯¯1: å­¦ä¹ ç‡å¤ªå°
```yaml
# é”™è¯¯
optim_conf:
  lr: 5e-6  # è¿™æ˜¯é¢„è®­ç»ƒçš„LR,ä¸é€‚åˆå¾®è°ƒ
  
# æ­£ç¡® (config_8k_telephone)
optim_conf:
  lr: 5e-5  # æˆ– 1e-4 for stage1
```

### âŒ é”™è¯¯2: å¿˜è®°è§£å†»Encoder
```yaml
# é”™è¯¯
audio_encoder_conf:
  freeze: true  # Encoderæœªè®­ç»ƒ,æ— æ³•é€‚åº”8kHz

# æ­£ç¡®
audio_encoder_conf:
  freeze: false  # Encoderå¯ä»¥è®­ç»ƒ
```

### âŒ é”™è¯¯3: å¯ç”¨DeepSpeedå•æœºè®­ç»ƒ
```yaml
# é”™è¯¯
train_conf:
  use_deepspeed: true  # å•GPUä¸éœ€è¦DeepSpeed

# æ­£ç¡®
train_conf:
  use_deepspeed: false  # å…³é—­åˆ†å¸ƒå¼è®­ç»ƒ
```

### âŒ é”™è¯¯4: æ²¡æœ‰Weight Decay
```yaml
# é”™è¯¯
optim_conf:
  weight_decay: 0.0  # å¾®è°ƒå®¹æ˜“è¿‡æ‹Ÿåˆ

# æ­£ç¡®
optim_conf:
  weight_decay: 0.01  # åŠ å…¥L2æ­£åˆ™åŒ–
```

### âŒ é”™è¯¯5: æ²¡æœ‰SpecAugmentation
```yaml
# é”™è¯¯
# (configä¸­æ²¡æœ‰specaugéƒ¨åˆ†)

# æ­£ç¡®
specaug: SpecAugLFR
specaug_conf:
  apply_freq_mask: true
  freq_mask_width_range: [0, 15]
  apply_time_mask: true
  time_mask_width_range: [0, 10]  # æˆ– [0, 50] for stage1
  num_time_mask: 1  # æˆ– 2 for stage1
```

---

## ğŸ“‹ è®­ç»ƒå‰æ£€æŸ¥æ¸…å•

å¤åˆ¶ä¸‹é¢çš„æ¸…å•,åœ¨å¼€å§‹è®­ç»ƒå‰å®Œæˆæ£€æŸ¥:

```
[ ] 1. Encoderæ˜¯å¦å¯è®­ç»ƒ?
    - audio_encoder_conf.freeze: false
    [ ] Yes [ ] No

[ ] 2. LLMå’ŒAdaptoræ˜¯å¦å†»ç»“?
    - llm_conf.freeze: true
    - audio_adaptor_conf.freeze: true
    [ ] Yes [ ] No

[ ] 3. å­¦ä¹ ç‡æ˜¯å¦åˆç†?
    - config_8k_telephone: lr: 5e-5
    - stage1_encoder_adapt: lr: 1e-4
    [ ] Yes [ ] No (è‡ªå®šä¹‰) [ ] Need Review

[ ] 4. DeepSpeedæ˜¯å¦ç¦ç”¨?
    - train_conf.use_deepspeed: false
    [ ] Yes [ ] No

[ ] 5. SpecAugmentationæ˜¯å¦å¯ç”¨?
    - specaug: SpecAugLFR
    [ ] Yes [ ] No

[ ] 6. æƒé‡è¡°å‡æ˜¯å¦å¯ç”¨?
    - optim_conf.weight_decay: 0.01
    [ ] Yes [ ] No

[ ] 7. CTC DecoderçŠ¶æ€æ˜¯å¦æ­£ç¡®?
    - config_8k_telephone: freeze: false (è®­ç»ƒ)
    - stage1_encoder_adapt: freeze: true (å†»ç»“)
    [ ] Yes [ ] No [ ] Other: ____

[ ] 8. Frontendé‡‡æ ·ç‡æ˜¯å¦æ­£ç¡®?
    - config_8k_telephone: fs: 16000
    - stage1_encoder_adapt: fs: 8000
    [ ] Verified [ ] Need Check

[ ] 9. é¢„è®­ç»ƒæƒé‡æ˜¯å¦åŠ è½½?
    - ä½¿ç”¨ --init_param=path/to/model.pt
    [ ] Yes [ ] No [ ] Will set in script

[ ] 10. è¾“å‡ºç›®å½•æ˜¯å¦å‡†å¤‡å¥½?
    - output_dir: æœ‰è‡³å°‘50GBå¯ç”¨ç©ºé—´
    [ ] Yes [ ] No [ ] Need Fix

å·²æ£€æŸ¥é¡¹: _____ / 10
å»ºè®®: æ‰€æœ‰é¡¹éƒ½åº”è¯¥å‹¾é€‰"Yes"æˆ–"Verified"
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### ä½¿ç”¨é»˜è®¤é…ç½®
```bash
# ä½¿ç”¨ config_8k_telephone.yaml (æ¨èåˆå­¦è€…)
cd /workspace/share/LLMFunASR
python -m funasr.bin.train_asr \
  --config examples/industrial_data_pretraining/fun_asr_nano_8k_telephone/conf/config_8k_telephone.yaml \
  --init_param <path-to-pretrained-model.pt> \
  --train_data_set_list <your-training-data> \
  --valid_data_set_list <your-validation-data> \
  --output_dir <output-directory>
```

### ä½¿ç”¨Stage1é…ç½®
```bash
# é¦–å…ˆä½¿ç”¨ stage1_encoder_adapt.yaml é€‚åº”8kHz
python -m funasr.bin.train_asr \
  --config examples/industrial_data_pretraining/fun_asr_nano_8k_telephone/conf/stage1_encoder_adapt.yaml \
  --init_param <path-to-pretrained-model.pt> \
  --train_data_set_list <your-training-data> \
  --valid_data_set_list <your-validation-data> \
  --output_dir <stage1-output>
```

### è‡ªå®šä¹‰è¶…å‚æ•°
```bash
# åœ¨å‘½ä»¤è¡Œè¦†ç›–é…ç½®
python -m funasr.bin.train_asr \
  --config examples/industrial_data_pretraining/fun_asr_nano_8k_telephone/conf/config_8k_telephone.yaml \
  --optim_conf.lr 1e-4 \
  --train_conf.max_epoch 15 \
  --train_conf.keep_nbest_models 5 \
  --init_param <path> \
  --train_data_set_list <data> \
  --output_dir <output>
```

---

## ğŸ“– æ·±å…¥å­¦ä¹ èµ„æº

### ç†è§£é¢„è®­ç»ƒ vs å¾®è°ƒçš„åŒºåˆ«
- é¢„è®­ç»ƒé…ç½®: `/gpfs01/nfs_share/finrc/liangguang/cache/modelscope/models/FunAudioLLM/Fun-ASR-Nano-2512/config.yaml`
- å¯¹æ¯”åŸå§‹é…ç½®ä»¥ç†è§£å…¨éƒ¨æ”¹åŠ¨

### å‚è€ƒé…ç½®æ–‡ä»¶
- `config_8k_telephone.yaml` - å®Œæ•´å¾®è°ƒ (æ¨è)
- `stage1_encoder_adapt.yaml` - Encoderé€‚åº”ä¸“ç”¨
- `config_8k_telephone_from_hub.yaml` - ä»HubåŠ è½½æ¨¡å‹

### ç†è§£æ•°æ®å’ŒSpecAug
- æŸ¥çœ‹ `QUICK_CONFIG_DIFF.md` ç¬¬ 7ï¸âƒ£ èŠ‚ (SpecAugmentation)
- äº†è§£ä¸ºä»€ä¹ˆ8kHzéœ€è¦ç‰¹æ®Šçš„æ—¶é—´æ©ç é…ç½®

### å­¦ä¹ ç‡è°ƒæ•´
- å°æ•°æ® (<1000h): ä¿å®ˆçš„å­¦ä¹ ç‡(5e-5)
- å¤§æ•°æ® (>1000h): å¯ä»¥å°è¯•æ›´é«˜çš„å­¦ä¹ ç‡(1e-4)
- ç›‘æ§lossæ›²çº¿: åº”è¯¥å¹³ç¨³ä¸‹é™,ä¸åº”è¯¥å‘æ•£

---

## ğŸ’¬ å¸¸è§é—®é¢˜

**Q: æˆ‘åº”è¯¥ä½¿ç”¨å“ªä¸ªé…ç½®?**
A: æ¨èç”¨ `config_8k_telephone.yaml` å¼€å§‹ã€‚åªæœ‰åœ¨éœ€è¦ç‰¹åˆ«é€‚åº”8kHzæ—¶æ‰ç”¨ `stage1_encoder_adapt.yaml`ã€‚

**Q: å­¦ä¹ ç‡5e-5åˆé€‚å—?**
A: å¦‚æœlossä¸ä¸‹é™,å¯ä»¥è¯•è¯•1e-4ã€‚å¦‚æœè®­ç»ƒä¸ç¨³å®š,é™ä½åˆ°2e-5ã€‚

**Q: ä¸ºä»€ä¹ˆStage1ä½¿ç”¨8kHzè€ŒMainä½¿ç”¨16kHz?**
A: ä¸åŒç­–ç•¥ã€‚Stage1è®©encoderå­¦ä¹ 8kHzç‰¹æ€§;Mainç”¨ä¸Šé‡‡æ ·ä½¿ç”¨æ ‡å‡†16kHzå¤„ç†é“¾ã€‚

**Q: èƒ½å¦åŒæ—¶è®­ç»ƒå¤šä¸ªç»„ä»¶?**
A: å¯ä»¥,ä½†éœ€è¦æ›´ä¿å®ˆçš„å­¦ä¹ ç‡ã€‚ä¸åŒç»„ä»¶éœ€è¦å¹³è¡¡ã€‚

**Q: å¦‚ä½•çŸ¥é“è®­ç»ƒæ˜¯å¦æˆåŠŸ?**
A: æŸ¥çœ‹ `CONFIG_COMPARISON_TABLE.md` çš„"é¢„æœŸè®­ç»ƒæ•ˆæœ"è¡¨ã€‚Lossåº”ä¸‹é™30-50%ã€‚

**Q: å¯ä»¥è·³è¿‡SpecAugmentationå—?**
A: ä¸æ¨èã€‚SpecAugæ˜¯å¾®è°ƒæˆåŠŸçš„å…³é”®,å°¤å…¶å¯¹8kHzæ•°æ®ã€‚

---

## ğŸ“ åé¦ˆå’Œæ”¹è¿›

å¦‚æœå‘ç°é…ç½®å¯¹é½æ–‡æ¡£æœ‰é—®é¢˜æˆ–å¯ä»¥æ”¹è¿›,è¯·:
1. æ£€æŸ¥ CONFIGURATION_ALIGNMENT.md æ˜¯å¦æœ‰ç›¸åŒé—®é¢˜
2. æ£€æŸ¥åŸå§‹é¢„è®­ç»ƒé…ç½®æ˜¯å¦æœ‰å˜æ›´
3. æäº¤é—®é¢˜æŠ¥å‘Š

---

**æœ€åæ›´æ–°:** 2025-01-05  
**é…ç½®å‚è€ƒ:** Fun-ASR-Nano-2512 (Fun-ASR-Nano-2512/config.yaml)  
**æ–‡æ¡£ç‰ˆæœ¬:** 1.0  
