# Stage 0 å®ŒæˆæŠ¥å‘Š - æ•°æ®å‡†å¤‡

**å®Œæˆæ—¶é—´**: 2026-01-05  
**çŠ¶æ€**: âœ… æ•°æ®å‡†å¤‡å·²æˆåŠŸå®Œæˆ

---

## ğŸ“Š æ•°æ®å‡†å¤‡æˆæœ

### æ¨¡æ‹Ÿæ•°æ®ï¼ˆWenetSpeech ç”µè¯ä¿¡é“ï¼‰

**è®­ç»ƒé›†**:
- æ ·æœ¬æ•°: 63,782 âœ…
- åŸå§‹æ ·æœ¬: 65,170
- è¿‡æ»¤æ ·æœ¬: 1,388 (speech_lengthè¿‡é•¿)
- è·¯å¾„: `exp_output/data/simulated_8k_telephone/train_formatted.jsonl`

**éªŒè¯é›†**:
- æ ·æœ¬æ•°: 13,825 âœ…
- è·¯å¾„: `exp_output/data/simulated_8k_telephone/dev_formatted.jsonl`

**æ•°æ®å¢å¼ºæ•ˆæœ**:
- é™é‡‡æ ·è‡³ 8kHz âœ“
- G.711 Î¼-law ç¼–è§£ç å¤±çœŸ âœ“
- 300-3400Hz å¸¦é€šæ»¤æ³¢ âœ“
- ç™½å™ªå£° + å·¥é¢‘å¹²æ‰° âœ“
- Babble Noise (10-25dB SNR) âœ“

---

### çœŸå®æ•°æ®ï¼ˆç”µè¯å¤–å‘¼åœºæ™¯ï¼‰

**è®­ç»ƒé›†**:
- åŸå§‹æ ·æœ¬: 12,172
- æ³¨é‡Šé”™è¯¯: 571
- **æœ‰æ•ˆæ ·æœ¬: 8,992** âœ…
- è¿‡æ»¤æ ·æœ¬: 2,609 (é•¿åº¦ä¸ç¬¦)
- è·¯å¾„: `exp_output/data/real_8k_telephone/train_formatted.jsonl`

**éªŒè¯é›†**:
- åŸå§‹æ ·æœ¬: 9,001  
- æ³¨é‡Šé”™è¯¯: 782
- **æœ‰æ•ˆæ ·æœ¬: 7,685** âœ…
- è¿‡æ»¤æ ·æœ¬: 534 (é•¿åº¦ä¸ç¬¦)
- è·¯å¾„: `exp_output/data/real_8k_telephone/dev_formatted.jsonl`

**æ•°æ®ç‰¹å¾**:
- ç”µé”€ã€å®¢æœã€å‚¬æ”¶åœºæ™¯ âœ“
- çœŸå®ç”µè¯çº¿è·¯è´¨é‡ âœ“
- å·²è¿‡æ»¤ `<ANNOTATION_ERROR>` âœ“
- å·²ä¸Šé‡‡æ ·è‡³ 16kHz âœ“

---

## ğŸ“‹ æ•°æ®éªŒè¯ç¤ºä¾‹

### æ ¼å¼æ£€æŸ¥ (âœ“ é€šè¿‡)
```json
{
    "key": "sample_00000001",
    "messages": [
        {"role": "system", "content": "You are a helpful assistant."},
        {"role": "user", "content": "è¯­éŸ³è½¬å†™ï¼š<|startofspeech|>!/path/to/audio.wav<|endofspeech|>"},
        {"role": "assistant", "content": "ç”Ÿå‘½åªæ˜¯ä¸€ä¸ªå¾ˆå°çš„ä»£ä»·"}
    ],
    "speech_length": 39,
    "text_length": 11
}
```

### ç»Ÿè®¡æŒ‡æ ‡
- å¹³å‡ speech_length: ~37-50 å¸§
- å¹³å‡ text_length: ~10-15 å­—
- æ ·æœ¬å®Œæ•´æ€§: 100% âœ“

---

## ğŸ”§ å·²çŸ¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: æ¨¡å‹åˆå§‹åŒ–è·¯å¾„
**ç—‡çŠ¶**: `init_param does not exist`

**åŸå› **: è„šæœ¬ä½¿ç”¨äº† MODELSCOPE_CACHE ç¯å¢ƒå˜é‡ï¼Œä½†æ¨¡å‹åœ¨ä¸åŒè·¯å¾„

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆ A: ä¸‹è½½æ¨¡å‹åˆ°æ­£ç¡®ä½ç½®
python -c "from modelscope import snapshot_download; \
           snapshot_download('FunAudioLLM/Fun-ASR-Nano-2512')"

# æ–¹æ¡ˆ B: ä¿®æ”¹ run_experiment.sh ä¸­çš„æ¨¡å‹è·¯å¾„ä¸ºå®é™…ä½ç½®
ptm_checkpoint="/actual/path/to/model.pt"
```

### é—®é¢˜ 2: ä½ç½®ç¼–ç ç»´åº¦ä¸åŒ¹é…  
**ç—‡çŠ¶**: `RuntimeError: The size of tensor a (17) must match the size of tensor b (18)`

**åŸå› **: ä¸Šé‡‡æ ·å¯¼è‡´æ—¶é—´åºåˆ—é•¿åº¦å˜åŒ–ï¼Œä¸é¢„è®­ç»ƒæ¨¡å‹çš„ä½ç½®ç¼–ç ä¸åŒ¹é…

**åŸå› åˆ†æ**:
- WavFrontend ä½¿ç”¨ LFR (Low Frame Rate) ä¸‹é‡‡æ ·å› å­ä¸º 6
- 8kHz éŸ³é¢‘ä¸Šé‡‡æ ·è‡³ 16kHz åï¼Œæ—¶é—´ç»´åº¦å¢åŠ 
- é¢„è®­ç»ƒæ¨¡å‹çš„ä½ç½®ç¼–ç åœ¨å¾®è°ƒæ—¶éœ€è¦è°ƒæ•´

**è§£å†³æ–¹æ¡ˆ**:
1. **ä¸ä½¿ç”¨ä¸Šé‡‡æ ·** - ç›´æ¥ä½¿ç”¨ 8kHz éŸ³é¢‘ï¼Œä¿®æ”¹ WavFrontend é‡‡æ ·ç‡å‚æ•°
2. **å‡å°‘è¿‡æ»¤é˜ˆå€¼** - å¢åŠ  max_speech_length å…è®¸æ›´é•¿çš„åºåˆ—
3. **ä½¿ç”¨æ’å€¼ä½ç½®ç¼–ç ** - ä¿®æ”¹æ¨¡å‹ä»£ç æ”¯æŒåŠ¨æ€ä½ç½®ç¼–ç é•¿åº¦

**æ¨èæ–¹æ¡ˆ**: è°ƒæ•´é…ç½®å…è®¸æ›´é•¿çš„åºåˆ—ï¼ŒåŒæ—¶ä¿®æ”¹ä¸Šé‡‡æ ·ç­–ç•¥

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
exp_output/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ simulated_8k_telephone/
â”‚   â”‚   â”œâ”€â”€ train_formatted.jsonl     (63,782 samples)
â”‚   â”‚   â”œâ”€â”€ dev_formatted.jsonl       (13,825 samples)
â”‚   â”‚   â”œâ”€â”€ train_simulated.jsonl     (åŸå§‹æ¨¡æ‹Ÿæ•°æ®)
â”‚   â”‚   â”œâ”€â”€ dev_simulated.jsonl
â”‚   â”‚   â””â”€â”€ audio/                    (æ¨¡æ‹ŸéŸ³é¢‘æ–‡ä»¶)
â”‚   â””â”€â”€ real_8k_telephone/
â”‚       â”œâ”€â”€ train_formatted.jsonl     (8,992 samples)
â”‚       â”œâ”€â”€ dev_formatted.jsonl       (7,685 samples)
â”‚       â””â”€â”€ audio_upsampled/          (ä¸Šé‡‡æ ·éŸ³é¢‘)
â””â”€â”€ exp/
    â””â”€â”€ 8k_telephone/                 (å¾…è®­ç»ƒ)
```

---

## âœ… ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ä¿®å¤æ–¹æ¡ˆ (æ¨è)

```bash
# 1. ä¿®æ”¹ Stage 1 é…ç½®ï¼Œè°ƒæ•´ WavFrontend ä»¥æ”¯æŒ 8kHz è¾“å…¥
# ç¼–è¾‘ conf/stage1_encoder_adapt.yaml:
# - frontend_conf.fs: 8000 (æ”¹ä¸º 8000)
# - dataset_conf.max_token_length: 8000 â†’ 10000
# - audio_encoder_conf.tp_blocks: 20 â†’ 10 (å‡å°‘TPå¹¶è¡Œ)

# 2. é‡æ–°è¿è¡Œ Stage 1
bash run_experiment.sh 1 1
```

### é…ç½®ä¿®æ”¹æ¸…å•

**conf/stage1_encoder_adapt.yaml**:
```yaml
frontend:
  fs: 8000  # æ”¹ä¸º 8000
  
dataset_conf:
  max_token_length: 10000  # å¢åŠ ä¸Šé™
  
audio_encoder_conf:
  tp_blocks: 10  # å‡å°‘å¼ é‡å¹¶è¡Œå—
```

---

## ğŸ“ˆ Stage 0 å®Œæˆç»Ÿè®¡

| æŒ‡æ ‡ | æ¨¡æ‹Ÿæ•°æ® | çœŸå®æ•°æ® | æ€»è®¡ |
|------|--------|--------|------|
| è®­ç»ƒæ ·æœ¬ | 63,782 | 8,992 | 72,774 |
| éªŒè¯æ ·æœ¬ | 13,825 | 7,685 | 21,510 |
| æœ‰æ•ˆæ ·æœ¬ | 77,607 | 16,677 | 94,284 |
| æ³¨é‡Šé”™è¯¯ | 0 | 1,353 | 1,353 |
| è¿‡æ»¤æ ·æœ¬ | 1,388 | 3,143 | 4,531 |
| **æ€»å¤„ç†** | **65,170** | **21,173** | **86,343** |

---

## ğŸ¯ å…³é”®è§‚å¯Ÿ

1. **æ•°æ®è´¨é‡**: ç”µè¯æ•°æ®æœ‰ 6% æ³¨é‡Šé”™è¯¯ç‡ï¼Œå·²æˆåŠŸè¿‡æ»¤
2. **æ ·æœ¬åˆ†å¸ƒ**: æ¨¡æ‹Ÿæ•°æ®å……è¶³ (63k+)ï¼ŒçœŸå®æ•°æ®æœ‰é™ (9k)
3. **æ—¶é—´é•¿åº¦**: å¤§éƒ¨åˆ†æ ·æœ¬ speech_length < 50 å¸§ï¼Œç¬¦åˆé¢„æœŸ
4. **æ¨¡å‹å…¼å®¹æ€§**: éœ€è¦è°ƒæ•´WavFrontendé‡‡æ ·ç‡ä»¥å¤„ç†8kHzè¾“å…¥

---

## åç»­æ”¹è¿›å»ºè®®

1. **æ•°æ®å¢å¼ºä¼˜åŒ–**:
   - å¢åŠ  VoIP ä¸¢å¸§æ¨¡æ‹Ÿçš„é€¼çœŸåº¦
   - æ·»åŠ æ›´å¤šå£éŸ³/æ–¹è¨€å˜å¼‚

2. **æ ·æœ¬è¿‡æ»¤ä¼˜åŒ–**:
   - è°ƒæ•´ max_speech_length é˜ˆå€¼ä»¥ä¿ç•™æ›´å¤šæ ·æœ¬
   - å®ç°è‡ªé€‚åº”é•¿åº¦è¿‡æ»¤

3. **æ¨¡å‹é€‚é…**:
   - å®ç°åŠ¨æ€ä½ç½®ç¼–ç æ”¯æŒ
   - æµ‹è¯•ä¸åŒçš„ä¸Šé‡‡æ ·æ–¹æ³•

---

**Stage 0 æ•°æ®å‡†å¤‡ï¼šå®Œæˆ âœ…**

**ä¸‹ä¸€æ­¥**: ä¿®å¤ WavFrontend é…ç½® â†’ å¯åŠ¨ Stage 1 è®­ç»ƒ

